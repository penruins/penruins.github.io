<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="
  concurrent
  #


  synchronized
  #


  synchronized 的底层原理是什么？
  #


基于 jvm 的 Monitor 机制
通过进入和退出 Monitor 对象来实现方法和代码块的同步
字节码指令

monitorenter 获取 Monitor 的所有权
monitorexit 释放 Monitor 的所有权


同步方法的实现

ACC_SYNCHRONIZED 标志：当方法被 synchronized 修饰时，JVM 会在方法常量池中设置 ACC_SYNCHRONIZED 标志。
调用方法时，JVM 检查该标志。如果设置了，线程必须先获取 Monitor 才能执行方法，执行完成后释放 Monitor


锁的优化

为了提升性能，JVM 对 synchronized 进行了优化，包括

偏向锁（Biased Locking）：当锁始终由同一线程持有时，JVM 会将锁标记为偏向锁，减少锁获取的开销
轻量级锁（Lightweight Locking）：当存在多个线程交替执行时，JVM 会将锁升级为轻量级锁，通过 CAS 操作减少阻塞
重量级锁（Heavyweight Locking）：当锁竞争激烈时，JVM 会将锁升级为重量级锁，依赖于操作系统的互斥量（Mutex）实现
自旋锁（Spin Locking）：当线程无法获取锁时，会进行有限次数的自旋尝试，避免直接进入阻塞状态






  ConcurrentHashMap
  #


  ConcurrentLinkedHashMap
  #


  比较 ConcurrentHash 和 ConcurrentLinkedHashMap
  #


在ConcurrentHashMap的基础上，增加了双向链表来维护插入顺序或访问顺序
支持LRU缓存淘汰策略，通过Weigher计算存储单元数，自动清理最近最少使用的数据


  线程池
  #


  线程池的核心参数
  #


核心线程数 corePoolSize
最大线程数 maximumPoolSize
空闲线程存活时间 keepAliveTime
时间单位 unit
任务队列 workQueue

ArrayBlockingQueue 基于数组的有界队列
LinkedBlockingQueue 基于链表的无界队列
SynchronousQueue 不存储元素的队列，直接交给线程处理
PriorityBlockingQueue 支持优先级的无界队列


线程工厂 threadFactory
拒绝策略 handler

AbortPolicy 抛弃任务并抛出异常 RejectedExecutionException
DiscardPolicy 抛弃任务但不抛出异常
CallerRunsPolicy 由提交任务的线程自己执行任务
DiscardOldestPolicy 抛弃优先级最低的任务




  线程池的关键参数，比如核心线程数、等待队列、拒绝策略，在创建的时候做什么考虑
  #


核心线程数

任务类型

CPU密集型: CPU核数 &#43; 1
IO密集型: CPU核数 * 2




最大线程数

默认设置为与核心线程数一致，减少创建线程和销毁线程的开销


等待队列

无界队列: 任务量稳定的场景, 但可能导致内存溢出
有界队列: 任务量波动的场景
同步队列: 适合任务量较少的场景


拒绝策略

任务重要性: 如果任务不能丢弃，使用 CallerRunsPolicy(由提交任务的线程自己执行任务)
系统容错性: 如果任务可以丢弃, 使用 DiscardPolicy(抛弃任务但不抛出异常) 和 DiscardOldestPolicy(抛弃优先级最低的任务)


线程空闲时间

任务波动性: 如果任务波动较大，可以设置较短的空闲时间，及时回收线程

如果在出现任务峰值的时候，创建线程锁产生的开销要如何处理？




线程工厂

线程命名: 自定义线程名称，便于监控与查询问题
线程优先级: 根据任务重要性设置线程优先级




  线程池拒绝策略有哪些，你项目通常选用哪个，遇到重要场景触发拒绝策略必须需要处理任务你如何处理
  #


线程池拒绝策略

AbortPolicy 抛异常
CallerRunsPolicy
DiscardPolicy 不抛异常
DiscardOldestPolicy


项目中常用哪个？

可以容忍丢失的情况 DiscardPolicy DiscardOldestPolicy
不允许有丢弃的情况：CallerRunsPolicy


重要场景触发拒绝策略的处理方法

使用 CallerRunsPolicy
自定义拒绝策略：增加自定义异常处理器，将拒绝的任务添加到外部的消息队列中，后续再进行提交


动态调整线程池的参数

监控线程池的状态，动态调整 corePoolSize, maximumPoolSize, queueCapacity, 以应对突发流量




  如何实现动态线程池？
  #


通过线程池的方法设置核心线程数、最大线程数、最大空闲时间


  JDK 创建线程池有哪些方式
  #


通过 Executors 工厂类创建

newFixedThreadPool
newCachedThreadPool
newSingleThreadExecutor
newScheduledThreadPool
newSingleThreadScheduledExecutor
newWorkStealingPool


通过 ThreadPoolExecutor 手动指定参数创建


  进程间通信
  #


管道 Pipe
消息队列 Message Queue
共享内存 Shared Memory
信号 Signal

kill


信号量 Semaphore
套接字 Socket
文件 File
内存映射文件 Memory-Mapped File
远程过程调用 RPC, Remote Procedure Call


  JUC
  #


java.util.concurrent


  JUC 包下的7大类
  #


原子变量类（java.util.concurrent.atomic 包）

用于实现无锁的线程安全操作，基于CAS（Compare and Swap）机制：
AtomicInteger：原子操作的整型变量。
AtomicLong：原子操作的长整型变量。
AtomicBoolean：原子操作的布尔变量。
AtomicReference&lt;V&gt;：原子操作的引用类型变量。
AtomicStampedReference&lt;V&gt;：带版本戳的原子引用，解决ABA问题。


锁和同步器类（java.util.concurrent.locks 包）

提供更灵活的锁机制，替代传统的synchronized关键字：
ReentrantLock：可重入锁，支持公平锁和非公平锁。
ReentrantReadWriteLock：读写锁，支持读多写少的场景。
StampedLock：基于邮戳的锁，提供乐观读锁。
Condition：条件变量，用于线程间的等待和唤醒。


并发集合类（java.util.concurrent 包）

线程安全的集合类，优化了高并发场景下的性能：
ConcurrentHashMap：线程安全的哈希表，采用分段锁或CAS机制。
CopyOnWriteArrayList：写时复制的线程安全列表，适合读多写少的场景。
ConcurrentLinkedQueue：无界的线程安全队列，基于CAS实现。


同步工具类

用于线程间的协作和同步：
CountDownLatch：计数器门闩，等待一组线程完成。
CyclicBarrier：循环栅栏，等待一组线程到达同步点。
Semaphore：信号量，控制同时访问资源的线程数量。
Phaser：更灵活的同步器，支持动态注册线程和多次同步。


线程池框架（java.util.concurrent 包）

用于管理线程的生命周期和任务调度：
ExecutorService：线程池接口，提供任务提交、关闭等功能。
ThreadPoolExecutor：可自定义的线程池实现。
ScheduledExecutorService：支持定时任务和周期任务的线程池。
ForkJoinPool：用于分治算法和并行流的线程池。


阻塞队列类（java.util.concurrent 包）

线程安全的阻塞队列，用于生产者-消费者模型：
ArrayBlockingQueue：基于数组的有界阻塞队列。
LinkedBlockingQueue：基于链表的无界阻塞队列。
PriorityBlockingQueue：支持优先级的无界阻塞队列。


其他工具类

Future&lt;V&gt;：表示异步计算的结果。
CompletableFuture&lt;V&gt;：支持异步编程的增强版Future。
Exchanger&lt;V&gt;：用于线程间交换数据的工具。




  ThreadLocal
  #


  ThreadLocal 原理
  #


每一个线程都维护一个对象副本，每个线程独立地访问和操作各自的副本
数据是保存在 Thread 父类的 ThreadLocalMap 中


  锁
  #


  Java里的锁有哪些
  #


锁的类型

synchronized 内置锁
ReentrantLock 可重入锁
ReadWriteLock 读写锁
StampedLock 邮戳锁
Condition 条件锁

与ReentrantLock 配合使用，实现线程间的等待和唤醒
类似于 Object.wait() 和 Object.notify()，但更灵活


LockSupport
Semaphore 信号量
CountDownLatch 倒计时锁
CyclicBarrier 循环屏障
Phaser 阶段锁


不同的锁的使用场景

简单场景：使用 synchronized
复杂场景：使用 ReentrantLock、ReadWriteLock 或 StampedLock
线程协作：使用 Condition、CountDownLatch、CyclicBarrier 或 Phaser
资源限制：使用 Semaphore




  锁升级
  #


  锁升级的过程
  #


锁机制根据竞争情况自动或手动调整锁的粒度和强度的过程，目的是在保证线程安全的同时优化性能
在Java中，锁升级特指synchronized关键字的优化机制。JDK 1.6后，为了减少锁操作的开销，JVM引入了偏向锁、轻量级锁、重量级锁三种状态，锁状态只能从低到高单向升级，不可降级


  锁升级的4个阶段是什么？
  #


无锁状态

共享对象没有被任何线程锁定


偏向锁

首次通过 synchronized 获取锁时，JVM讲锁标记为偏向锁


轻量级锁

当多线程竞争偏向锁时，JVM讲锁由偏向锁转换为轻量级锁
通过CAS实现


重量级锁

轻量级锁自旋失败（如自旋次数超过阈值）或高并发竞争激烈时
依赖操作系统的互斥量 Mutex




  公平、非公平
  #


  什么是公平锁、非公平锁？
  #


公平锁：线程根据申请锁的顺序获取锁
非公平锁：允许线程直接获取锁，而不用考虑申请锁的顺序


  synchronized 是公平的还是不公平的？
  #


不公平的


  ReentrantLock 公平性
  #


可以在构造可重入锁时指定是公平锁还是非公平锁

AQS AbstractQueuedSynchronizer的队列机制

FairSync 维护一个 FIFO 的队列






  CAS
  #


  什么是CAS
  #


一个原子性的硬件指令 compare and swap 比较并交换。多线程的场景下，只有一个线程能比较成功并交换值，其他线程比较失败不执行交换


  AQS
  #


  什么是AQS
  #


AbstractQueuedSynchronizer 用于构造锁和同步器类的基础类

ReentrantLock
Semaphore
CountDownLatch




  AQS的核心概念是什么？
  #


同步状态
等待队列


  AQS的模板方法有哪些？
  #


tryAcquire
tryRelease
tryAcquireShared
tryAcquireReleased


  ABA 问题
  #


  ABA问题产生的原因是什么？
  #


使用 CAS 实现无锁数据结构，因为CAS只关注数据是否一致，没有关注数据是否更改过


  如何解决ABA问题？
  #


使用版本号, 比如使用原子变量类AtomicStampedReference


  JDK提供的原子变量类会存在ABA问题吗？
  #
">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="#343a40">
<meta name="color-scheme" content="light dark"><meta property="og:url" content="/post/computer-science/java/concurrent/">
  <meta property="og:site_name" content="Penruins">
  <meta property="og:title" content="concurrent">
  <meta property="og:description" content="concurrent # synchronized # synchronized 的底层原理是什么？ # 基于 jvm 的 Monitor 机制 通过进入和退出 Monitor 对象来实现方法和代码块的同步 字节码指令 monitorenter 获取 Monitor 的所有权 monitorexit 释放 Monitor 的所有权 同步方法的实现 ACC_SYNCHRONIZED 标志：当方法被 synchronized 修饰时，JVM 会在方法常量池中设置 ACC_SYNCHRONIZED 标志。 调用方法时，JVM 检查该标志。如果设置了，线程必须先获取 Monitor 才能执行方法，执行完成后释放 Monitor 锁的优化 为了提升性能，JVM 对 synchronized 进行了优化，包括 偏向锁（Biased Locking）：当锁始终由同一线程持有时，JVM 会将锁标记为偏向锁，减少锁获取的开销 轻量级锁（Lightweight Locking）：当存在多个线程交替执行时，JVM 会将锁升级为轻量级锁，通过 CAS 操作减少阻塞 重量级锁（Heavyweight Locking）：当锁竞争激烈时，JVM 会将锁升级为重量级锁，依赖于操作系统的互斥量（Mutex）实现 自旋锁（Spin Locking）：当线程无法获取锁时，会进行有限次数的自旋尝试，避免直接进入阻塞状态 ConcurrentHashMap # ConcurrentLinkedHashMap # 比较 ConcurrentHash 和 ConcurrentLinkedHashMap # 在ConcurrentHashMap的基础上，增加了双向链表来维护插入顺序或访问顺序 支持LRU缓存淘汰策略，通过Weigher计算存储单元数，自动清理最近最少使用的数据 线程池 # 线程池的核心参数 # 核心线程数 corePoolSize 最大线程数 maximumPoolSize 空闲线程存活时间 keepAliveTime 时间单位 unit 任务队列 workQueue ArrayBlockingQueue 基于数组的有界队列 LinkedBlockingQueue 基于链表的无界队列 SynchronousQueue 不存储元素的队列，直接交给线程处理 PriorityBlockingQueue 支持优先级的无界队列 线程工厂 threadFactory 拒绝策略 handler AbortPolicy 抛弃任务并抛出异常 RejectedExecutionException DiscardPolicy 抛弃任务但不抛出异常 CallerRunsPolicy 由提交任务的线程自己执行任务 DiscardOldestPolicy 抛弃优先级最低的任务 线程池的关键参数，比如核心线程数、等待队列、拒绝策略，在创建的时候做什么考虑 # 核心线程数 任务类型 CPU密集型: CPU核数 &#43; 1 IO密集型: CPU核数 * 2 最大线程数 默认设置为与核心线程数一致，减少创建线程和销毁线程的开销 等待队列 无界队列: 任务量稳定的场景, 但可能导致内存溢出 有界队列: 任务量波动的场景 同步队列: 适合任务量较少的场景 拒绝策略 任务重要性: 如果任务不能丢弃，使用 CallerRunsPolicy(由提交任务的线程自己执行任务) 系统容错性: 如果任务可以丢弃, 使用 DiscardPolicy(抛弃任务但不抛出异常) 和 DiscardOldestPolicy(抛弃优先级最低的任务) 线程空闲时间 任务波动性: 如果任务波动较大，可以设置较短的空闲时间，及时回收线程 如果在出现任务峰值的时候，创建线程锁产生的开销要如何处理？ 线程工厂 线程命名: 自定义线程名称，便于监控与查询问题 线程优先级: 根据任务重要性设置线程优先级 线程池拒绝策略有哪些，你项目通常选用哪个，遇到重要场景触发拒绝策略必须需要处理任务你如何处理 # 线程池拒绝策略 AbortPolicy 抛异常 CallerRunsPolicy DiscardPolicy 不抛异常 DiscardOldestPolicy 项目中常用哪个？ 可以容忍丢失的情况 DiscardPolicy DiscardOldestPolicy 不允许有丢弃的情况：CallerRunsPolicy 重要场景触发拒绝策略的处理方法 使用 CallerRunsPolicy 自定义拒绝策略：增加自定义异常处理器，将拒绝的任务添加到外部的消息队列中，后续再进行提交 动态调整线程池的参数 监控线程池的状态，动态调整 corePoolSize, maximumPoolSize, queueCapacity, 以应对突发流量 如何实现动态线程池？ # 通过线程池的方法设置核心线程数、最大线程数、最大空闲时间 JDK 创建线程池有哪些方式 # 通过 Executors 工厂类创建 newFixedThreadPool newCachedThreadPool newSingleThreadExecutor newScheduledThreadPool newSingleThreadScheduledExecutor newWorkStealingPool 通过 ThreadPoolExecutor 手动指定参数创建 进程间通信 # 管道 Pipe 消息队列 Message Queue 共享内存 Shared Memory 信号 Signal kill 信号量 Semaphore 套接字 Socket 文件 File 内存映射文件 Memory-Mapped File 远程过程调用 RPC, Remote Procedure Call JUC # java.util.concurrent JUC 包下的7大类 # 原子变量类（java.util.concurrent.atomic 包） 用于实现无锁的线程安全操作，基于CAS（Compare and Swap）机制： AtomicInteger：原子操作的整型变量。 AtomicLong：原子操作的长整型变量。 AtomicBoolean：原子操作的布尔变量。 AtomicReference&lt;V&gt;：原子操作的引用类型变量。 AtomicStampedReference&lt;V&gt;：带版本戳的原子引用，解决ABA问题。 锁和同步器类（java.util.concurrent.locks 包） 提供更灵活的锁机制，替代传统的synchronized关键字： ReentrantLock：可重入锁，支持公平锁和非公平锁。 ReentrantReadWriteLock：读写锁，支持读多写少的场景。 StampedLock：基于邮戳的锁，提供乐观读锁。 Condition：条件变量，用于线程间的等待和唤醒。 并发集合类（java.util.concurrent 包） 线程安全的集合类，优化了高并发场景下的性能： ConcurrentHashMap：线程安全的哈希表，采用分段锁或CAS机制。 CopyOnWriteArrayList：写时复制的线程安全列表，适合读多写少的场景。 ConcurrentLinkedQueue：无界的线程安全队列，基于CAS实现。 同步工具类 用于线程间的协作和同步： CountDownLatch：计数器门闩，等待一组线程完成。 CyclicBarrier：循环栅栏，等待一组线程到达同步点。 Semaphore：信号量，控制同时访问资源的线程数量。 Phaser：更灵活的同步器，支持动态注册线程和多次同步。 线程池框架（java.util.concurrent 包） 用于管理线程的生命周期和任务调度： ExecutorService：线程池接口，提供任务提交、关闭等功能。 ThreadPoolExecutor：可自定义的线程池实现。 ScheduledExecutorService：支持定时任务和周期任务的线程池。 ForkJoinPool：用于分治算法和并行流的线程池。 阻塞队列类（java.util.concurrent 包） 线程安全的阻塞队列，用于生产者-消费者模型： ArrayBlockingQueue：基于数组的有界阻塞队列。 LinkedBlockingQueue：基于链表的无界阻塞队列。 PriorityBlockingQueue：支持优先级的无界阻塞队列。 其他工具类 Future&lt;V&gt;：表示异步计算的结果。 CompletableFuture&lt;V&gt;：支持异步编程的增强版Future。 Exchanger&lt;V&gt;：用于线程间交换数据的工具。 ThreadLocal # ThreadLocal 原理 # 每一个线程都维护一个对象副本，每个线程独立地访问和操作各自的副本 数据是保存在 Thread 父类的 ThreadLocalMap 中 锁 # Java里的锁有哪些 # 锁的类型 synchronized 内置锁 ReentrantLock 可重入锁 ReadWriteLock 读写锁 StampedLock 邮戳锁 Condition 条件锁 与ReentrantLock 配合使用，实现线程间的等待和唤醒 类似于 Object.wait() 和 Object.notify()，但更灵活 LockSupport Semaphore 信号量 CountDownLatch 倒计时锁 CyclicBarrier 循环屏障 Phaser 阶段锁 不同的锁的使用场景 简单场景：使用 synchronized 复杂场景：使用 ReentrantLock、ReadWriteLock 或 StampedLock 线程协作：使用 Condition、CountDownLatch、CyclicBarrier 或 Phaser 资源限制：使用 Semaphore 锁升级 # 锁升级的过程 # 锁机制根据竞争情况自动或手动调整锁的粒度和强度的过程，目的是在保证线程安全的同时优化性能 在Java中，锁升级特指synchronized关键字的优化机制。JDK 1.6后，为了减少锁操作的开销，JVM引入了偏向锁、轻量级锁、重量级锁三种状态，锁状态只能从低到高单向升级，不可降级 锁升级的4个阶段是什么？ # 无锁状态 共享对象没有被任何线程锁定 偏向锁 首次通过 synchronized 获取锁时，JVM讲锁标记为偏向锁 轻量级锁 当多线程竞争偏向锁时，JVM讲锁由偏向锁转换为轻量级锁 通过CAS实现 重量级锁 轻量级锁自旋失败（如自旋次数超过阈值）或高并发竞争激烈时 依赖操作系统的互斥量 Mutex 公平、非公平 # 什么是公平锁、非公平锁？ # 公平锁：线程根据申请锁的顺序获取锁 非公平锁：允许线程直接获取锁，而不用考虑申请锁的顺序 synchronized 是公平的还是不公平的？ # 不公平的 ReentrantLock 公平性 # 可以在构造可重入锁时指定是公平锁还是非公平锁 AQS AbstractQueuedSynchronizer的队列机制 FairSync 维护一个 FIFO 的队列 CAS # 什么是CAS # 一个原子性的硬件指令 compare and swap 比较并交换。多线程的场景下，只有一个线程能比较成功并交换值，其他线程比较失败不执行交换 AQS # 什么是AQS # AbstractQueuedSynchronizer 用于构造锁和同步器类的基础类 ReentrantLock Semaphore CountDownLatch AQS的核心概念是什么？ # 同步状态 等待队列 AQS的模板方法有哪些？ # tryAcquire tryRelease tryAcquireShared tryAcquireReleased ABA 问题 # ABA问题产生的原因是什么？ # 使用 CAS 实现无锁数据结构，因为CAS只关注数据是否一致，没有关注数据是否更改过 如何解决ABA问题？ # 使用版本号, 比如使用原子变量类AtomicStampedReference JDK提供的原子变量类会存在ABA问题吗？ #">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="post">
    <meta property="article:modified_time" content="2025-08-04T09:09:23+08:00">
<title>concurrent | Penruins</title>
<link rel="icon" href="/favicon.png" >
<link rel="manifest" href="/manifest.json">
<link rel="canonical" href="/post/computer-science/java/concurrent/">
<link rel="stylesheet" href="/book.min.906e34f8c022f0b84a196adcca9b010338f8538635067c7b810a46d6dd81c80c.css" >
  <script defer src="/fuse.min.js"></script>
  <script defer src="/en.search.min.f7f3f67f921826c82f1669677bed228814e8b31499046d8b2daeef31a336a284.js" ></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->
  
</head>
<body dir="ltr">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    <aside class="book-menu">
      <div class="book-menu-content">
        
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/"><span>Penruins</span>
  </a>
</h2>


<div class="book-search hidden">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>
<script>document.querySelector(".book-search").classList.remove("hidden")</script>















  
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-1f044d5fe299e2a50ad480135136465e" class="toggle"  />
    <label for="section-1f044d5fe299e2a50ad480135136465e" class="flex justify-between">
      <a role="button" class="">Life</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/post/life/books/" class="">books</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/post/life/%E6%91%98%E6%8A%84%E5%88%86%E4%BA%AB/" class="">摘抄分享</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/post/life/%E6%96%B0%E7%9F%A5/" class="">新知</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/post/life/movies-log/" class="">观影记录</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/post/life/bilibili/" class="">bilibili</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/post/life/cycling/" class="">cycling</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/post/life/hiking/" class="">hiking</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/post/life/life-recommend/" class="">life recommand</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/post/life/learning-others-log/" class="">other learning</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/post/life/podcast/" class="">podcast</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/post/life/politics/" class="">politics</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/post/life/goal/" class="">goal</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/post/life/coffee/" class="">coffee</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/post/life/article/" class="">article</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-0e80d916dfbf49a298199837cff9b464" class="toggle" checked />
    <label for="section-0e80d916dfbf49a298199837cff9b464" class="flex justify-between">
      <a role="button" class="">Computer Science</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/post/computer-science/computer-science/" class="">computer science</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-7ab6eb16d87ee717ab25cc84269ec7f9" class="toggle"  />
    <label for="section-7ab6eb16d87ee717ab25cc84269ec7f9" class="flex justify-between">
      <a role="button" class="">Big Data</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/post/computer-science/big-data/hadoop/" class="">hadoop</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/post/computer-science/big-data/hbase/" class="">hbase</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/post/computer-science/big-data/hive/" class="">hive</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-859fd182f99952efd6ae86320529c63d" class="toggle"  />
    <label for="section-859fd182f99952efd6ae86320529c63d" class="flex justify-between">
      <a role="button" class="">Database</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/post/computer-science/database/database/" class="">database</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/post/computer-science/database/druid/" class="">druid</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/post/computer-science/database/elasticsearch/" class="">elasticsearch</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/post/computer-science/database/mycat/" class="">mycat</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/post/computer-science/database/mysql/" class="">mysql</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/post/computer-science/database/postgresql/" class="">postgresql</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/post/computer-science/database/shardingsphere/" class="">shardingsphere</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/post/computer-science/database/sql/" class="">SQL</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/post/computer-science/database/mongodb/" class="">Penruins</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-08231b363489d85c9f808700d743ce65" class="toggle"  />
    <label for="section-08231b363489d85c9f808700d743ce65" class="flex justify-between">
      <a role="button" class="">Distributed System</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-92803a0b927e7b223b49867047da77ad" class="toggle"  />
    <label for="section-92803a0b927e7b223b49867047da77ad" class="flex justify-between">
      <a role="button" class="">Message Queue</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/post/computer-science/distributed-system/message-queue/kafka/" class="">kafka</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/post/computer-science/distributed-system/message-queue/message-queue/" class="">Message Queue</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/post/computer-science/distributed-system/message-queue/rabbitmq/" class="">rabbitmq</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/post/computer-science/distributed-system/distributed-system/" class="">distributed system</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/post/computer-science/distributed-system/sentinel/" class="">Sentinel</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/post/computer-science/distributed-system/spring-cloud/" class="">Spring Cloud</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/post/computer-science/distributed-system/spring-cloud-alibaba/" class="">Spring Cloud Alibaba</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-ca0677f03580f20779b09f474723b113" class="toggle" checked />
    <label for="section-ca0677f03580f20779b09f474723b113" class="flex justify-between">
      <a role="button" class="">Java</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/post/computer-science/java/java-basic/" class="">java basic</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/post/computer-science/java/java/" class="">java</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/post/computer-science/java/concurrent/" class="active">concurrent</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/post/computer-science/java/jvm/" class="">jvm</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/post/computer-science/java/mybatis/" class="">Mybatis</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/post/computer-science/java/spring/" class="">spring</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/post/computer-science/java/springboot/" class="">spring boot</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-38c4d1edc00af801a5cead99c216a484" class="toggle"  />
    <label for="section-38c4d1edc00af801a5cead99c216a484" class="flex justify-between">
      <a role="button" class="">Monitor</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/post/computer-science/monitor/prometheus/" class="">prometheus</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-580097d540eb28e9fcf7fd7cfd7cf3f5" class="toggle"  />
    <label for="section-580097d540eb28e9fcf7fd7cfd7cf3f5" class="flex justify-between">
      <a role="button" class="">Tools</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/post/computer-science/tools/idea/" class="">IDEA</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/post/computer-science/computer-science-recommend/" class="">推荐</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/post/computer-science/computer-science-learning-log/" class="">学习记录</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/post/computer-science/echarts/" class="">echarts</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/post/computer-science/github/" class="">github</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/post/computer-science/ios/" class="">ios</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/post/computer-science/job/" class="">job</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/post/computer-science/linux/" class="">linux</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/post/computer-science/mac/" class="">mac</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/post/computer-science/raspberrypi/" class="">raspberry pi</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/post/computer-science/redis/" class="">redis</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/post/computer-science/security/" class="">security</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/post/computer-science/vue/" class="">vue</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/post/computer-science/algorithm/" class="">Algorithm</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/post/computer-science/cloud/" class="">Cloud</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/post/computer-science/hugo/" class="">Hugo</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/post/computer-science/nacos/" class="">Nacos</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/post/computer-science/artificial-intelligence/" class="">Artificial Intelligence</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/post/computer-science/crawler/" class="">crawler</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/post/computer-science/jenkins/" class="">Jenkins</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/post/computer-science/nexus/" class="">Nexus</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/post/computer-science/python/" class="">Python</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/post/computer-science/vim/" class="">vim</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/post/computer-science/%E7%B3%BB%E7%BB%9F%E8%AE%BE%E8%AE%A1/" class="">系统设计</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-3409a4049a7a8d62c70ecac8b1f58f2c" class="toggle"  />
    <label for="section-3409a4049a7a8d62c70ecac8b1f58f2c" class="flex justify-between">
      <a role="button" class="">History</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/post/history/%E4%B8%AD%E5%9B%BD%E5%8E%86%E5%8F%B2/" class="">中国历史</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-ddb61fbbb5f4750721f7a5d8dc727ca0" class="toggle"  />
    <label for="section-ddb61fbbb5f4750721f7a5d8dc727ca0" class="flex justify-between">
      <a role="button" class="">Others</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/post/others/about-me/" class="">about me</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/post/others/english-learning/" class="">English Learning</a>
  

        </li>
      
    
      
    
      
        <li>
          
  
  

  
    <a href="/post/others/f1/" class="">F1</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-f13963d33b0147768eccb2769cbf8a17" class="toggle"  />
    <label for="section-f13963d33b0147768eccb2769cbf8a17" class="flex justify-between">
      <a role="button" class="">Sports</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/post/sports/cycling/" class="">cycling</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/post/sports/table-tennis/" class="">table tennis</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-b03f134e351d6516fb4925d3cccc721f" class="toggle"  />
    <label for="section-b03f134e351d6516fb4925d3cccc721f" class="flex justify-between">
      <a role="button" class="">Books</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-3045b94b25ef0b17b04a92aba83672b7" class="toggle"  />
    <label for="section-3045b94b25ef0b17b04a92aba83672b7" class="flex justify-between">
      <a role="button" class="">Computer Science</a>
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/post/books/computer-science/java%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B%E5%AE%9E%E6%88%98/" class="">Java并发编程实战</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/post/books/computer-science/python%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/" class="">Python神经网络编程</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/post/books/computer-science/redis%E8%AE%BE%E8%AE%A1%E4%B8%8E%E5%AE%9E%E7%8E%B0/" class="">Redis设计与实现</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/post/books/computer-science/spring-cloud%E5%BE%AE%E6%9C%8D%E5%8A%A1%E5%85%A5%E9%97%A8%E5%AE%9E%E6%88%98%E4%B8%8E%E8%BF%9B%E9%98%B6/" class="">Spring Cloud微服务：入门、实战与进阶</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/post/books/computer-science/%E4%B8%80%E6%9C%AC%E4%B9%A6%E8%AE%B2%E9%80%8F-elasticsearch%E5%8E%9F%E7%90%86%E8%BF%9B%E9%98%B6%E4%B8%8E%E5%B7%A5%E7%A8%8B%E5%AE%9E%E8%B7%B5/" class="">一本书讲透 ElasticSearch：原理、进阶与工程实践</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/post/books/%E5%AE%8F%E8%A7%82%E7%BB%8F%E6%B5%8E%E5%AD%A6-%E7%AC%AC%E4%B8%89%E7%89%88/" class="">宏观经济学 第三版</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/post/books/%E8%8B%B1%E4%BC%9F%E8%BE%BE-%E9%BB%84%E4%BB%81%E5%8B%8B%E4%B9%8B%E8%8A%AF/" class="">英伟达-黄仁勋之芯</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>














</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
      </div>
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <h3>concurrent</h3>

  <label for="toc-control">
    
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden clearfix">
    
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#concurrent">concurrent</a>
      <ul>
        <li><a href="#synchronized">synchronized</a>
          <ul>
            <li><a href="#synchronized-的底层原理是什么">synchronized 的底层原理是什么？</a></li>
          </ul>
        </li>
        <li><a href="#concurrenthashmap">ConcurrentHashMap</a></li>
        <li><a href="#concurrentlinkedhashmap">ConcurrentLinkedHashMap</a>
          <ul>
            <li><a href="#比较-concurrenthash-和-concurrentlinkedhashmap">比较 ConcurrentHash 和 ConcurrentLinkedHashMap</a></li>
          </ul>
        </li>
        <li><a href="#线程池">线程池</a>
          <ul>
            <li><a href="#线程池的核心参数">线程池的核心参数</a></li>
            <li><a href="#线程池的关键参数比如核心线程数等待队列拒绝策略在创建的时候做什么考虑">线程池的关键参数，比如核心线程数、等待队列、拒绝策略，在创建的时候做什么考虑</a></li>
            <li><a href="#线程池拒绝策略有哪些你项目通常选用哪个遇到重要场景触发拒绝策略必须需要处理任务你如何处理">线程池拒绝策略有哪些，你项目通常选用哪个，遇到重要场景触发拒绝策略必须需要处理任务你如何处理</a></li>
            <li><a href="#如何实现动态线程池">如何实现动态线程池？</a></li>
            <li><a href="#jdk-创建线程池有哪些方式">JDK 创建线程池有哪些方式</a></li>
          </ul>
        </li>
        <li><a href="#进程间通信">进程间通信</a></li>
        <li><a href="#juc">JUC</a>
          <ul>
            <li><a href="#juc-包下的7大类">JUC 包下的7大类</a></li>
          </ul>
        </li>
        <li><a href="#threadlocal">ThreadLocal</a>
          <ul>
            <li><a href="#threadlocal-原理">ThreadLocal 原理</a></li>
          </ul>
        </li>
        <li><a href="#锁">锁</a>
          <ul>
            <li><a href="#java里的锁有哪些">Java里的锁有哪些</a></li>
            <li><a href="#锁升级">锁升级</a>
              <ul>
                <li><a href="#锁升级的过程">锁升级的过程</a></li>
                <li><a href="#锁升级的4个阶段是什么">锁升级的4个阶段是什么？</a></li>
              </ul>
            </li>
            <li><a href="#公平非公平">公平、非公平</a>
              <ul>
                <li><a href="#什么是公平锁非公平锁">什么是公平锁、非公平锁？</a></li>
                <li><a href="#synchronized-是公平的还是不公平的">synchronized 是公平的还是不公平的？</a></li>
                <li><a href="#reentrantlock-公平性">ReentrantLock 公平性</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#cas">CAS</a>
          <ul>
            <li><a href="#什么是cas">什么是CAS</a></li>
          </ul>
        </li>
        <li><a href="#aqs">AQS</a>
          <ul>
            <li><a href="#什么是aqs">什么是AQS</a></li>
            <li><a href="#aqs的核心概念是什么">AQS的核心概念是什么？</a></li>
            <li><a href="#aqs的模板方法有哪些">AQS的模板方法有哪些？</a></li>
          </ul>
        </li>
        <li><a href="#aba-问题">ABA 问题</a>
          <ul>
            <li><a href="#aba问题产生的原因是什么">ABA问题产生的原因是什么？</a></li>
            <li><a href="#如何解决aba问题">如何解决ABA问题？</a></li>
            <li><a href="#jdk提供的原子变量类会存在aba问题吗">JDK提供的原子变量类会存在ABA问题吗？</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
  <article class="markdown book-article"><h1 id="concurrent">
  concurrent
  <a class="anchor" href="#concurrent">#</a>
</h1>
<h2 id="synchronized">
  synchronized
  <a class="anchor" href="#synchronized">#</a>
</h2>
<h3 id="synchronized-的底层原理是什么">
  synchronized 的底层原理是什么？
  <a class="anchor" href="#synchronized-%e7%9a%84%e5%ba%95%e5%b1%82%e5%8e%9f%e7%90%86%e6%98%af%e4%bb%80%e4%b9%88">#</a>
</h3>
<ul>
<li>基于 jvm 的 Monitor 机制</li>
<li>通过进入和退出 Monitor 对象来实现方法和代码块的同步</li>
<li>字节码指令
<ul>
<li><code>monitorenter</code> 获取 Monitor 的所有权</li>
<li><code>monitorexit</code> 释放 Monitor 的所有权</li>
</ul>
</li>
<li>同步方法的实现
<ul>
<li>ACC_SYNCHRONIZED 标志：当方法被 synchronized 修饰时，JVM 会在方法常量池中设置 ACC_SYNCHRONIZED 标志。</li>
<li>调用方法时，JVM 检查该标志。如果设置了，线程必须先获取 Monitor 才能执行方法，执行完成后释放 Monitor</li>
</ul>
</li>
<li>锁的优化
<ul>
<li>为了提升性能，JVM 对 synchronized 进行了优化，包括
<ul>
<li>偏向锁（Biased Locking）：当锁始终由同一线程持有时，JVM 会将锁标记为偏向锁，减少锁获取的开销</li>
<li>轻量级锁（Lightweight Locking）：当存在多个线程交替执行时，JVM 会将锁升级为轻量级锁，通过 CAS 操作减少阻塞</li>
<li>重量级锁（Heavyweight Locking）：当锁竞争激烈时，JVM 会将锁升级为重量级锁，依赖于操作系统的互斥量（Mutex）实现</li>
<li>自旋锁（Spin Locking）：当线程无法获取锁时，会进行有限次数的自旋尝试，避免直接进入阻塞状态</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="concurrenthashmap">
  ConcurrentHashMap
  <a class="anchor" href="#concurrenthashmap">#</a>
</h2>
<h2 id="concurrentlinkedhashmap">
  ConcurrentLinkedHashMap
  <a class="anchor" href="#concurrentlinkedhashmap">#</a>
</h2>
<h3 id="比较-concurrenthash-和-concurrentlinkedhashmap">
  比较 ConcurrentHash 和 ConcurrentLinkedHashMap
  <a class="anchor" href="#%e6%af%94%e8%be%83-concurrenthash-%e5%92%8c-concurrentlinkedhashmap">#</a>
</h3>
<ul>
<li>在ConcurrentHashMap的基础上，增加了<strong>双向链表</strong>来维护插入顺序或访问顺序</li>
<li>支持LRU缓存淘汰策略，通过Weigher计算存储单元数，自动清理最近最少使用的数据</li>
</ul>
<h2 id="线程池">
  线程池
  <a class="anchor" href="#%e7%ba%bf%e7%a8%8b%e6%b1%a0">#</a>
</h2>
<h3 id="线程池的核心参数">
  线程池的核心参数
  <a class="anchor" href="#%e7%ba%bf%e7%a8%8b%e6%b1%a0%e7%9a%84%e6%a0%b8%e5%bf%83%e5%8f%82%e6%95%b0">#</a>
</h3>
<ul>
<li>核心线程数 corePoolSize</li>
<li>最大线程数 maximumPoolSize</li>
<li>空闲线程存活时间 keepAliveTime</li>
<li>时间单位 unit</li>
<li>任务队列 workQueue
<ul>
<li>ArrayBlockingQueue 基于数组的<strong>有界</strong>队列</li>
<li>LinkedBlockingQueue 基于链表的<strong>无界</strong>队列</li>
<li>SynchronousQueue 不存储元素的队列，直接交给线程处理</li>
<li>PriorityBlockingQueue 支持优先级的<strong>无界</strong>队列</li>
</ul>
</li>
<li>线程工厂 threadFactory</li>
<li>拒绝策略 handler
<ul>
<li>AbortPolicy 抛弃任务并抛出异常 RejectedExecutionException</li>
<li>DiscardPolicy 抛弃任务但不抛出异常</li>
<li>CallerRunsPolicy 由提交任务的线程自己执行任务</li>
<li>DiscardOldestPolicy 抛弃优先级最低的任务</li>
</ul>
</li>
</ul>
<h3 id="线程池的关键参数比如核心线程数等待队列拒绝策略在创建的时候做什么考虑">
  线程池的关键参数，比如核心线程数、等待队列、拒绝策略，在创建的时候做什么考虑
  <a class="anchor" href="#%e7%ba%bf%e7%a8%8b%e6%b1%a0%e7%9a%84%e5%85%b3%e9%94%ae%e5%8f%82%e6%95%b0%e6%af%94%e5%a6%82%e6%a0%b8%e5%bf%83%e7%ba%bf%e7%a8%8b%e6%95%b0%e7%ad%89%e5%be%85%e9%98%9f%e5%88%97%e6%8b%92%e7%bb%9d%e7%ad%96%e7%95%a5%e5%9c%a8%e5%88%9b%e5%bb%ba%e7%9a%84%e6%97%b6%e5%80%99%e5%81%9a%e4%bb%80%e4%b9%88%e8%80%83%e8%99%91">#</a>
</h3>
<ul>
<li>核心线程数
<ul>
<li>任务类型
<ul>
<li>CPU密集型: CPU核数 + 1</li>
<li>IO密集型: CPU核数 * 2</li>
</ul>
</li>
</ul>
</li>
<li>最大线程数
<ul>
<li>默认设置为与核心线程数一致，减少创建线程和销毁线程的开销</li>
</ul>
</li>
<li>等待队列
<ul>
<li>无界队列: 任务量稳定的场景, 但可能导致内存溢出</li>
<li>有界队列: 任务量波动的场景</li>
<li>同步队列: 适合任务量较少的场景</li>
</ul>
</li>
<li>拒绝策略
<ul>
<li>任务重要性: 如果任务不能丢弃，使用 CallerRunsPolicy(由提交任务的线程自己执行任务)</li>
<li>系统容错性: 如果任务可以丢弃, 使用 DiscardPolicy(抛弃任务但不抛出异常) 和 DiscardOldestPolicy(抛弃优先级最低的任务)</li>
</ul>
</li>
<li>线程空闲时间
<ul>
<li>任务波动性: 如果任务波动较大，可以设置较短的空闲时间，及时回收线程
<ul>
<li>如果在出现任务峰值的时候，创建线程锁产生的开销要如何处理？</li>
</ul>
</li>
</ul>
</li>
<li>线程工厂
<ul>
<li>线程命名: 自定义线程名称，便于监控与查询问题</li>
<li>线程优先级: 根据任务重要性设置线程优先级</li>
</ul>
</li>
</ul>
<h3 id="线程池拒绝策略有哪些你项目通常选用哪个遇到重要场景触发拒绝策略必须需要处理任务你如何处理">
  线程池拒绝策略有哪些，你项目通常选用哪个，遇到重要场景触发拒绝策略必须需要处理任务你如何处理
  <a class="anchor" href="#%e7%ba%bf%e7%a8%8b%e6%b1%a0%e6%8b%92%e7%bb%9d%e7%ad%96%e7%95%a5%e6%9c%89%e5%93%aa%e4%ba%9b%e4%bd%a0%e9%a1%b9%e7%9b%ae%e9%80%9a%e5%b8%b8%e9%80%89%e7%94%a8%e5%93%aa%e4%b8%aa%e9%81%87%e5%88%b0%e9%87%8d%e8%a6%81%e5%9c%ba%e6%99%af%e8%a7%a6%e5%8f%91%e6%8b%92%e7%bb%9d%e7%ad%96%e7%95%a5%e5%bf%85%e9%a1%bb%e9%9c%80%e8%a6%81%e5%a4%84%e7%90%86%e4%bb%bb%e5%8a%a1%e4%bd%a0%e5%a6%82%e4%bd%95%e5%a4%84%e7%90%86">#</a>
</h3>
<ul>
<li>线程池拒绝策略
<ul>
<li>AbortPolicy 抛异常</li>
<li>CallerRunsPolicy</li>
<li>DiscardPolicy 不抛异常</li>
<li>DiscardOldestPolicy</li>
</ul>
</li>
<li>项目中常用哪个？
<ul>
<li>可以容忍丢失的情况 DiscardPolicy DiscardOldestPolicy</li>
<li>不允许有丢弃的情况：CallerRunsPolicy</li>
</ul>
</li>
<li>重要场景触发拒绝策略的处理方法
<ul>
<li>使用 CallerRunsPolicy</li>
<li>自定义拒绝策略：增加自定义异常处理器，将拒绝的任务添加到外部的消息队列中，后续再进行提交</li>
</ul>
</li>
<li>动态调整线程池的参数
<ul>
<li>监控线程池的状态，动态调整 corePoolSize, maximumPoolSize, queueCapacity, 以应对突发流量</li>
</ul>
</li>
</ul>
<h3 id="如何实现动态线程池">
  如何实现动态线程池？
  <a class="anchor" href="#%e5%a6%82%e4%bd%95%e5%ae%9e%e7%8e%b0%e5%8a%a8%e6%80%81%e7%ba%bf%e7%a8%8b%e6%b1%a0">#</a>
</h3>
<ul>
<li>通过线程池的方法设置<strong>核心线程数</strong>、<strong>最大线程数</strong>、<strong>最大空闲时间</strong></li>
</ul>
<h3 id="jdk-创建线程池有哪些方式">
  JDK 创建线程池有哪些方式
  <a class="anchor" href="#jdk-%e5%88%9b%e5%bb%ba%e7%ba%bf%e7%a8%8b%e6%b1%a0%e6%9c%89%e5%93%aa%e4%ba%9b%e6%96%b9%e5%bc%8f">#</a>
</h3>
<ul>
<li>通过 <code>Executors</code> 工厂类创建
<ul>
<li>newFixedThreadPool</li>
<li>newCachedThreadPool</li>
<li>newSingleThreadExecutor</li>
<li>newScheduledThreadPool</li>
<li>newSingleThreadScheduledExecutor</li>
<li>newWorkStealingPool</li>
</ul>
</li>
<li>通过 <code>ThreadPoolExecutor</code> 手动指定参数创建</li>
</ul>
<h2 id="进程间通信">
  进程间通信
  <a class="anchor" href="#%e8%bf%9b%e7%a8%8b%e9%97%b4%e9%80%9a%e4%bf%a1">#</a>
</h2>
<ul>
<li>管道 Pipe</li>
<li>消息队列 Message Queue</li>
<li>共享内存 Shared Memory</li>
<li>信号 Signal
<ul>
<li>kill</li>
</ul>
</li>
<li>信号量 Semaphore</li>
<li>套接字 Socket</li>
<li>文件 File</li>
<li>内存映射文件 Memory-Mapped File</li>
<li>远程过程调用 RPC, Remote Procedure Call</li>
</ul>
<h2 id="juc">
  JUC
  <a class="anchor" href="#juc">#</a>
</h2>
<ul>
<li><code>java.util.concurrent</code></li>
</ul>
<h3 id="juc-包下的7大类">
  JUC 包下的7大类
  <a class="anchor" href="#juc-%e5%8c%85%e4%b8%8b%e7%9a%847%e5%a4%a7%e7%b1%bb">#</a>
</h3>
<ul>
<li><strong>原子变量类（<code>java.util.concurrent.atomic</code> 包）</strong>
<ul>
<li>用于实现无锁的线程安全操作，基于CAS（Compare and Swap）机制：</li>
<li><code>AtomicInteger</code>：原子操作的整型变量。</li>
<li><code>AtomicLong</code>：原子操作的长整型变量。</li>
<li><code>AtomicBoolean</code>：原子操作的布尔变量。</li>
<li><code>AtomicReference&lt;V&gt;</code>：原子操作的引用类型变量。</li>
<li><code>AtomicStampedReference&lt;V&gt;</code>：带版本戳的原子引用，解决ABA问题。</li>
</ul>
</li>
<li><strong>锁和同步器类（<code>java.util.concurrent.locks</code> 包）</strong>
<ul>
<li>提供更灵活的锁机制，替代传统的<code>synchronized</code>关键字：</li>
<li><code>ReentrantLock</code>：可重入锁，支持公平锁和非公平锁。</li>
<li><code>ReentrantReadWriteLock</code>：读写锁，支持读多写少的场景。</li>
<li><code>StampedLock</code>：基于邮戳的锁，提供乐观读锁。</li>
<li><code>Condition</code>：条件变量，用于线程间的等待和唤醒。</li>
</ul>
</li>
<li><strong>并发集合类（<code>java.util.concurrent</code> 包）</strong>
<ul>
<li>线程安全的集合类，优化了高并发场景下的性能：</li>
<li><code>ConcurrentHashMap</code>：线程安全的哈希表，采用分段锁或CAS机制。</li>
<li><code>CopyOnWriteArrayList</code>：写时复制的线程安全列表，适合读多写少的场景。</li>
<li><code>ConcurrentLinkedQueue</code>：无界的线程安全队列，基于CAS实现。</li>
</ul>
</li>
<li><strong>同步工具类</strong>
<ul>
<li>用于线程间的协作和同步：</li>
<li><code>CountDownLatch</code>：计数器门闩，等待一组线程完成。</li>
<li><code>CyclicBarrier</code>：循环栅栏，等待一组线程到达同步点。</li>
<li><code>Semaphore</code>：信号量，控制同时访问资源的线程数量。</li>
<li><code>Phaser</code>：更灵活的同步器，支持动态注册线程和多次同步。</li>
</ul>
</li>
<li><strong>线程池框架（<code>java.util.concurrent</code> 包）</strong>
<ul>
<li>用于管理线程的生命周期和任务调度：</li>
<li><code>ExecutorService</code>：线程池接口，提供任务提交、关闭等功能。</li>
<li><code>ThreadPoolExecutor</code>：可自定义的线程池实现。</li>
<li><code>ScheduledExecutorService</code>：支持定时任务和周期任务的线程池。</li>
<li><code>ForkJoinPool</code>：用于分治算法和并行流的线程池。</li>
</ul>
</li>
<li><strong>阻塞队列类（<code>java.util.concurrent</code> 包）</strong>
<ul>
<li>线程安全的阻塞队列，用于生产者-消费者模型：</li>
<li><code>ArrayBlockingQueue</code>：基于数组的<strong>有界</strong>阻塞队列。</li>
<li><code>LinkedBlockingQueue</code>：基于链表的<strong>无界</strong>阻塞队列。</li>
<li><code>PriorityBlockingQueue</code>：支持优先级的无界阻塞队列。</li>
</ul>
</li>
<li><strong>其他工具类</strong>
<ul>
<li><code>Future&lt;V&gt;</code>：表示异步计算的结果。</li>
<li><code>CompletableFuture&lt;V&gt;</code>：支持异步编程的增强版<code>Future</code>。</li>
<li><code>Exchanger&lt;V&gt;</code>：用于线程间交换数据的工具。</li>
</ul>
</li>
</ul>
<h2 id="threadlocal">
  ThreadLocal
  <a class="anchor" href="#threadlocal">#</a>
</h2>
<h3 id="threadlocal-原理">
  ThreadLocal 原理
  <a class="anchor" href="#threadlocal-%e5%8e%9f%e7%90%86">#</a>
</h3>
<ul>
<li>每一个线程都维护一个对象副本，每个线程独立地访问和操作各自的副本</li>
<li>数据是保存在 Thread 父类的 ThreadLocalMap 中</li>
</ul>
<h2 id="锁">
  锁
  <a class="anchor" href="#%e9%94%81">#</a>
</h2>
<h3 id="java里的锁有哪些">
  Java里的锁有哪些
  <a class="anchor" href="#java%e9%87%8c%e7%9a%84%e9%94%81%e6%9c%89%e5%93%aa%e4%ba%9b">#</a>
</h3>
<ul>
<li>锁的类型
<ul>
<li>synchronized 内置锁</li>
<li>ReentrantLock 可重入锁</li>
<li>ReadWriteLock 读写锁</li>
<li>StampedLock 邮戳锁</li>
<li>Condition 条件锁
<ul>
<li>与ReentrantLock 配合使用，实现线程间的等待和唤醒</li>
<li>类似于 Object.wait() 和 Object.notify()，但更灵活</li>
</ul>
</li>
<li>LockSupport</li>
<li>Semaphore 信号量</li>
<li>CountDownLatch 倒计时锁</li>
<li>CyclicBarrier 循环屏障</li>
<li>Phaser 阶段锁</li>
</ul>
</li>
<li>不同的锁的使用场景
<ul>
<li>简单场景：使用 synchronized</li>
<li>复杂场景：使用 ReentrantLock、ReadWriteLock 或 StampedLock</li>
<li>线程协作：使用 Condition、CountDownLatch、CyclicBarrier 或 Phaser</li>
<li>资源限制：使用 Semaphore</li>
</ul>
</li>
</ul>
<h3 id="锁升级">
  锁升级
  <a class="anchor" href="#%e9%94%81%e5%8d%87%e7%ba%a7">#</a>
</h3>
<h4 id="锁升级的过程">
  锁升级的过程
  <a class="anchor" href="#%e9%94%81%e5%8d%87%e7%ba%a7%e7%9a%84%e8%bf%87%e7%a8%8b">#</a>
</h4>
<ul>
<li>锁机制根据竞争情况自动或手动调整锁的粒度和强度的过程，目的是在保证线程安全的同时优化性能</li>
<li>在Java中，锁升级特指synchronized关键字的优化机制。JDK 1.6后，为了减少锁操作的开销，JVM引入了<strong>偏向锁</strong>、<strong>轻量级锁</strong>、<strong>重量级锁</strong>三种状态，锁状态只能从低到高单向升级，不可降级</li>
</ul>
<h4 id="锁升级的4个阶段是什么">
  锁升级的4个阶段是什么？
  <a class="anchor" href="#%e9%94%81%e5%8d%87%e7%ba%a7%e7%9a%844%e4%b8%aa%e9%98%b6%e6%ae%b5%e6%98%af%e4%bb%80%e4%b9%88">#</a>
</h4>
<ul>
<li><strong>无锁状态</strong>
<ul>
<li>共享对象没有被任何线程锁定</li>
</ul>
</li>
<li><strong>偏向锁</strong>
<ul>
<li>首次通过 synchronized 获取锁时，JVM讲锁标记为偏向锁</li>
</ul>
</li>
<li><strong>轻量级锁</strong>
<ul>
<li>当多线程竞争偏向锁时，JVM讲锁由偏向锁转换为轻量级锁</li>
<li>通过CAS实现</li>
</ul>
</li>
<li><strong>重量级锁</strong>
<ul>
<li>轻量级锁自旋失败（如自旋次数超过阈值）或高并发竞争激烈时</li>
<li>依赖操作系统的互斥量 Mutex</li>
</ul>
</li>
</ul>
<h3 id="公平非公平">
  公平、非公平
  <a class="anchor" href="#%e5%85%ac%e5%b9%b3%e9%9d%9e%e5%85%ac%e5%b9%b3">#</a>
</h3>
<h4 id="什么是公平锁非公平锁">
  什么是公平锁、非公平锁？
  <a class="anchor" href="#%e4%bb%80%e4%b9%88%e6%98%af%e5%85%ac%e5%b9%b3%e9%94%81%e9%9d%9e%e5%85%ac%e5%b9%b3%e9%94%81">#</a>
</h4>
<ul>
<li>公平锁：线程根据申请锁的顺序获取锁</li>
<li>非公平锁：允许线程直接获取锁，而不用考虑申请锁的顺序</li>
</ul>
<h4 id="synchronized-是公平的还是不公平的">
  synchronized 是公平的还是不公平的？
  <a class="anchor" href="#synchronized-%e6%98%af%e5%85%ac%e5%b9%b3%e7%9a%84%e8%bf%98%e6%98%af%e4%b8%8d%e5%85%ac%e5%b9%b3%e7%9a%84">#</a>
</h4>
<ul>
<li>不公平的</li>
</ul>
<h4 id="reentrantlock-公平性">
  ReentrantLock 公平性
  <a class="anchor" href="#reentrantlock-%e5%85%ac%e5%b9%b3%e6%80%a7">#</a>
</h4>
<ul>
<li>可以在构造可重入锁时指定是公平锁还是非公平锁
<ul>
<li>AQS AbstractQueuedSynchronizer的队列机制
<ul>
<li>FairSync 维护一个 FIFO 的队列</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="cas">
  CAS
  <a class="anchor" href="#cas">#</a>
</h2>
<h3 id="什么是cas">
  什么是CAS
  <a class="anchor" href="#%e4%bb%80%e4%b9%88%e6%98%afcas">#</a>
</h3>
<ul>
<li>一个原子性的硬件指令 compare and swap 比较并交换。多线程的场景下，只有一个线程能比较成功并交换值，其他线程比较失败不执行交换</li>
</ul>
<h2 id="aqs">
  AQS
  <a class="anchor" href="#aqs">#</a>
</h2>
<h3 id="什么是aqs">
  什么是AQS
  <a class="anchor" href="#%e4%bb%80%e4%b9%88%e6%98%afaqs">#</a>
</h3>
<ul>
<li><code>AbstractQueuedSynchronizer</code> 用于构造锁和同步器类的基础类
<ul>
<li><code>ReentrantLock</code></li>
<li><code>Semaphore</code></li>
<li><code>CountDownLatch</code></li>
</ul>
</li>
</ul>
<h3 id="aqs的核心概念是什么">
  AQS的核心概念是什么？
  <a class="anchor" href="#aqs%e7%9a%84%e6%a0%b8%e5%bf%83%e6%a6%82%e5%bf%b5%e6%98%af%e4%bb%80%e4%b9%88">#</a>
</h3>
<ul>
<li>同步状态</li>
<li>等待队列</li>
</ul>
<h3 id="aqs的模板方法有哪些">
  AQS的模板方法有哪些？
  <a class="anchor" href="#aqs%e7%9a%84%e6%a8%a1%e6%9d%bf%e6%96%b9%e6%b3%95%e6%9c%89%e5%93%aa%e4%ba%9b">#</a>
</h3>
<ul>
<li>tryAcquire</li>
<li>tryRelease</li>
<li>tryAcquireShared</li>
<li>tryAcquireReleased</li>
</ul>
<h2 id="aba-问题">
  ABA 问题
  <a class="anchor" href="#aba-%e9%97%ae%e9%a2%98">#</a>
</h2>
<h3 id="aba问题产生的原因是什么">
  ABA问题产生的原因是什么？
  <a class="anchor" href="#aba%e9%97%ae%e9%a2%98%e4%ba%a7%e7%94%9f%e7%9a%84%e5%8e%9f%e5%9b%a0%e6%98%af%e4%bb%80%e4%b9%88">#</a>
</h3>
<ul>
<li>使用 CAS 实现无锁数据结构，因为CAS只关注数据是否一致，没有关注数据是否更改过</li>
</ul>
<h3 id="如何解决aba问题">
  如何解决ABA问题？
  <a class="anchor" href="#%e5%a6%82%e4%bd%95%e8%a7%a3%e5%86%b3aba%e9%97%ae%e9%a2%98">#</a>
</h3>
<ul>
<li>使用版本号, 比如使用原子变量类<code>AtomicStampedReference</code></li>
</ul>
<h3 id="jdk提供的原子变量类会存在aba问题吗">
  JDK提供的原子变量类会存在ABA问题吗？
  <a class="anchor" href="#jdk%e6%8f%90%e4%be%9b%e7%9a%84%e5%8e%9f%e5%ad%90%e5%8f%98%e9%87%8f%e7%b1%bb%e4%bc%9a%e5%ad%98%e5%9c%a8aba%e9%97%ae%e9%a2%98%e5%90%97">#</a>
</h3>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">


  <div><a class="flex align-center" href="https://github.com/penruins/penruins.github.io/commit/09952b952325c256cb8254e8125e3942667bd757" title='Last modified by penruins | August 4, 2025' target="_blank" rel="noopener">
      <img src="/svg/calendar.svg" class="book-icon" alt="" />
      <span>August 4, 2025</span>
    </a>
  </div>




</div>



  <script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script>


 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      <div class="book-toc-content">
        
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#concurrent">concurrent</a>
      <ul>
        <li><a href="#synchronized">synchronized</a>
          <ul>
            <li><a href="#synchronized-的底层原理是什么">synchronized 的底层原理是什么？</a></li>
          </ul>
        </li>
        <li><a href="#concurrenthashmap">ConcurrentHashMap</a></li>
        <li><a href="#concurrentlinkedhashmap">ConcurrentLinkedHashMap</a>
          <ul>
            <li><a href="#比较-concurrenthash-和-concurrentlinkedhashmap">比较 ConcurrentHash 和 ConcurrentLinkedHashMap</a></li>
          </ul>
        </li>
        <li><a href="#线程池">线程池</a>
          <ul>
            <li><a href="#线程池的核心参数">线程池的核心参数</a></li>
            <li><a href="#线程池的关键参数比如核心线程数等待队列拒绝策略在创建的时候做什么考虑">线程池的关键参数，比如核心线程数、等待队列、拒绝策略，在创建的时候做什么考虑</a></li>
            <li><a href="#线程池拒绝策略有哪些你项目通常选用哪个遇到重要场景触发拒绝策略必须需要处理任务你如何处理">线程池拒绝策略有哪些，你项目通常选用哪个，遇到重要场景触发拒绝策略必须需要处理任务你如何处理</a></li>
            <li><a href="#如何实现动态线程池">如何实现动态线程池？</a></li>
            <li><a href="#jdk-创建线程池有哪些方式">JDK 创建线程池有哪些方式</a></li>
          </ul>
        </li>
        <li><a href="#进程间通信">进程间通信</a></li>
        <li><a href="#juc">JUC</a>
          <ul>
            <li><a href="#juc-包下的7大类">JUC 包下的7大类</a></li>
          </ul>
        </li>
        <li><a href="#threadlocal">ThreadLocal</a>
          <ul>
            <li><a href="#threadlocal-原理">ThreadLocal 原理</a></li>
          </ul>
        </li>
        <li><a href="#锁">锁</a>
          <ul>
            <li><a href="#java里的锁有哪些">Java里的锁有哪些</a></li>
            <li><a href="#锁升级">锁升级</a>
              <ul>
                <li><a href="#锁升级的过程">锁升级的过程</a></li>
                <li><a href="#锁升级的4个阶段是什么">锁升级的4个阶段是什么？</a></li>
              </ul>
            </li>
            <li><a href="#公平非公平">公平、非公平</a>
              <ul>
                <li><a href="#什么是公平锁非公平锁">什么是公平锁、非公平锁？</a></li>
                <li><a href="#synchronized-是公平的还是不公平的">synchronized 是公平的还是不公平的？</a></li>
                <li><a href="#reentrantlock-公平性">ReentrantLock 公平性</a></li>
              </ul>
            </li>
          </ul>
        </li>
        <li><a href="#cas">CAS</a>
          <ul>
            <li><a href="#什么是cas">什么是CAS</a></li>
          </ul>
        </li>
        <li><a href="#aqs">AQS</a>
          <ul>
            <li><a href="#什么是aqs">什么是AQS</a></li>
            <li><a href="#aqs的核心概念是什么">AQS的核心概念是什么？</a></li>
            <li><a href="#aqs的模板方法有哪些">AQS的模板方法有哪些？</a></li>
          </ul>
        </li>
        <li><a href="#aba-问题">ABA 问题</a>
          <ul>
            <li><a href="#aba问题产生的原因是什么">ABA问题产生的原因是什么？</a></li>
            <li><a href="#如何解决aba问题">如何解决ABA问题？</a></li>
            <li><a href="#jdk提供的原子变量类会存在aba问题吗">JDK提供的原子变量类会存在ABA问题吗？</a></li>
          </ul>
        </li>
      </ul>
    </li>
  </ul>
</nav>


 
      </div>
    </aside>
    
  </main>

  
</body>
</html>












