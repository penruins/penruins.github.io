<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>Penruins</title>
    <link>https://penruins.github.io/hugo/post/computer-science/micro-service/</link>
    <description>Recent content on Penruins</description>
    <generator>Hugo</generator>
    <language>en</language>
    <copyright>[Main Page](/)</copyright>
    <atom:link href="https://penruins.github.io/hugo/post/computer-science/micro-service/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title></title>
      <link>https://penruins.github.io/hugo/post/computer-science/micro-service/nacos/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      <guid>https://penruins.github.io/hugo/post/computer-science/micro-service/nacos/</guid>
      <description>&lt;h1 id=&#34;关于-nacos-配置更新后避免-hikaricp-连接断开的问题&#34;&gt;关于 Nacos 配置更新后避免 HikariCP 连接断开的问题&lt;a class=&#34;anchor&#34; href=&#34;#%e5%85%b3%e4%ba%8e-nacos-%e9%85%8d%e7%bd%ae%e6%9b%b4%e6%96%b0%e5%90%8e%e9%81%bf%e5%85%8d-hikaricp-%e8%bf%9e%e6%8e%a5%e6%96%ad%e5%bc%80%e7%9a%84%e9%97%ae%e9%a2%98&#34;&gt;#&lt;/a&gt;&lt;/h1&gt;&#xA;&lt;h2 id=&#34;解决方案&#34;&gt;解决方案&lt;a class=&#34;anchor&#34; href=&#34;#%e8%a7%a3%e5%86%b3%e6%96%b9%e6%a1%88&#34;&gt;#&lt;/a&gt;&lt;/h2&gt;&#xA;&lt;h3 id=&#34;使用-refreshscopeproxymode--scopedproxymodeno-排除数据源&#34;&gt;使用 &lt;code&gt;@RefreshScope(proxyMode = ScopedProxyMode.NO)&lt;/code&gt; 排除数据源&lt;a class=&#34;anchor&#34; href=&#34;#%e4%bd%bf%e7%94%a8-refreshscopeproxymode--scopedproxymodeno-%e6%8e%92%e9%99%a4%e6%95%b0%e6%8d%ae%e6%ba%90&#34;&gt;#&lt;/a&gt;&lt;/h3&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;@Configuration&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;@RefreshScope&lt;/span&gt;(proxyMode &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; ScopedProxyMode.&lt;span style=&#34;color:#a6e22e&#34;&gt;NO&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;public&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;class&lt;/span&gt; &lt;span style=&#34;color:#a6e22e&#34;&gt;DataSourceConfig&lt;/span&gt; {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#75715e&#34;&gt;// 数据源配置&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;自定义-refreshscope-排除数据源相关配置&#34;&gt;自定义 RefreshScope 排除数据源相关配置&lt;a class=&#34;anchor&#34; href=&#34;#%e8%87%aa%e5%ae%9a%e4%b9%89-refreshscope-%e6%8e%92%e9%99%a4%e6%95%b0%e6%8d%ae%e6%ba%90%e7%9b%b8%e5%85%b3%e9%85%8d%e7%bd%ae&#34;&gt;#&lt;/a&gt;&lt;/h3&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;@Bean&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;public&lt;/span&gt; RefreshScope &lt;span style=&#34;color:#a6e22e&#34;&gt;refreshScope&lt;/span&gt;() {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    RefreshScope scope &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#66d9ef&#34;&gt;new&lt;/span&gt; RefreshScope();&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    scope.&lt;span style=&#34;color:#a6e22e&#34;&gt;setExcludeNames&lt;/span&gt;(&lt;span style=&#34;color:#66d9ef&#34;&gt;new&lt;/span&gt; String&lt;span style=&#34;color:#f92672&#34;&gt;[]&lt;/span&gt;{&lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;dataSource&amp;#34;&lt;/span&gt;, &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;hikariDataSource&amp;#34;&lt;/span&gt;});&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; scope;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;在-bootstrapyml-中排除特定配置的刷新&#34;&gt;在 bootstrap.yml 中排除特定配置的刷新&lt;a class=&#34;anchor&#34; href=&#34;#%e5%9c%a8-bootstrapyml-%e4%b8%ad%e6%8e%92%e9%99%a4%e7%89%b9%e5%ae%9a%e9%85%8d%e7%bd%ae%e7%9a%84%e5%88%b7%e6%96%b0&#34;&gt;#&lt;/a&gt;&lt;/h3&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-yaml&#34; data-lang=&#34;yaml&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#f92672&#34;&gt;spring&lt;/span&gt;:&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;  &lt;span style=&#34;color:#f92672&#34;&gt;cloud&lt;/span&gt;:&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#f92672&#34;&gt;nacos&lt;/span&gt;:&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;      &lt;span style=&#34;color:#f92672&#34;&gt;config&lt;/span&gt;:&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;refresh-enabled&lt;/span&gt;: &lt;span style=&#34;color:#66d9ef&#34;&gt;true&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;        &lt;span style=&#34;color:#f92672&#34;&gt;refreshable-data-sources&lt;/span&gt;: &lt;span style=&#34;color:#ae81ff&#34;&gt;none&lt;/span&gt; &lt;span style=&#34;color:#75715e&#34;&gt;# 不刷新数据源配置&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h3 id=&#34;使用-refreshscope-但不刷新数据源&#34;&gt;使用 &lt;code&gt;@RefreshScope&lt;/code&gt; 但不刷新数据源&lt;a class=&#34;anchor&#34; href=&#34;#%e4%bd%bf%e7%94%a8-refreshscope-%e4%bd%86%e4%b8%8d%e5%88%b7%e6%96%b0%e6%95%b0%e6%8d%ae%e6%ba%90&#34;&gt;#&lt;/a&gt;&lt;/h3&gt;&#xA;&lt;div class=&#34;highlight&#34;&gt;&lt;pre tabindex=&#34;0&#34; style=&#34;color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;&#34;&gt;&lt;code class=&#34;language-java&#34; data-lang=&#34;java&#34;&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;@Bean&lt;/span&gt;&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;@ConfigurationProperties&lt;/span&gt;(prefix &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; &lt;span style=&#34;color:#e6db74&#34;&gt;&amp;#34;spring.datasource.hikari&amp;#34;&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#a6e22e&#34;&gt;@RefreshScope&lt;/span&gt;(proxyMode &lt;span style=&#34;color:#f92672&#34;&gt;=&lt;/span&gt; ScopedProxyMode.&lt;span style=&#34;color:#a6e22e&#34;&gt;NO&lt;/span&gt;)&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;&lt;span style=&#34;color:#66d9ef&#34;&gt;public&lt;/span&gt; HikariDataSource &lt;span style=&#34;color:#a6e22e&#34;&gt;dataSource&lt;/span&gt;() {&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;    &lt;span style=&#34;color:#66d9ef&#34;&gt;return&lt;/span&gt; DataSourceBuilder.&lt;span style=&#34;color:#a6e22e&#34;&gt;create&lt;/span&gt;().&lt;span style=&#34;color:#a6e22e&#34;&gt;type&lt;/span&gt;(HikariDataSource.&lt;span style=&#34;color:#a6e22e&#34;&gt;class&lt;/span&gt;).&lt;span style=&#34;color:#a6e22e&#34;&gt;build&lt;/span&gt;();&#xA;&lt;/span&gt;&lt;/span&gt;&lt;span style=&#34;display:flex;&#34;&gt;&lt;span&gt;}&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;h2 id=&#34;最佳实践&#34;&gt;最佳实践&lt;a class=&#34;anchor&#34; href=&#34;#%e6%9c%80%e4%bd%b3%e5%ae%9e%e8%b7%b5&#34;&gt;#&lt;/a&gt;&lt;/h2&gt;&#xA;&lt;ol&gt;&#xA;&lt;li&gt;&lt;strong&gt;分离配置&lt;/strong&gt;：将数据库配置和其他频繁变动的配置分开，放在不同的配置文件中&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;版本控制&lt;/strong&gt;：对数据库配置的修改应该通过版本控制和应用重启来完成，而不是热更新&lt;/li&gt;&#xA;&lt;li&gt;&lt;strong&gt;监控&lt;/strong&gt;：即使解决了这个问题，也应该监控数据库连接池状态&lt;/li&gt;&#xA;&lt;/ol&gt;&#xA;&lt;h2 id=&#34;注意事项&#34;&gt;注意事项&lt;a class=&#34;anchor&#34; href=&#34;#%e6%b3%a8%e6%84%8f%e4%ba%8b%e9%a1%b9&#34;&gt;#&lt;/a&gt;&lt;/h2&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;这些解决方案可能会因 Spring Boot/Cloud 版本不同而有所差异&lt;/li&gt;&#xA;&lt;li&gt;在生产环境实施前应在测试环境充分验证&lt;/li&gt;&#xA;&lt;li&gt;如果确实需要动态修改数据库配置，建议使用更优雅的方式如多数据源切换&lt;/li&gt;&#xA;&lt;/ul&gt;</description>
    </item>
    <item>
      <title>micro service</title>
      <link>https://penruins.github.io/hugo/post/computer-science/micro-service/micro-service/</link>
      <pubDate>Mon, 01 Jan 0001 00:00:00 +0000</pubDate>
      <guid>https://penruins.github.io/hugo/post/computer-science/micro-service/micro-service/</guid>
      <description>&lt;h1 id=&#34;监控&#34;&gt;监控&lt;a class=&#34;anchor&#34; href=&#34;#%e7%9b%91%e6%8e%a7&#34;&gt;#&lt;/a&gt;&lt;/h1&gt;&#xA;&lt;ul&gt;&#xA;&lt;li&gt;&lt;a href=&#34;https://skywalking.apache.org/zh/2020-04-19-skywalking-quick-start/&#34;&gt;SkyWalking 极简入门&lt;/a&gt;&lt;/li&gt;&#xA;&lt;/ul&gt;</description>
    </item>
  </channel>
</rss>
